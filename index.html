<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Florida Trip 2026 | Josephine</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    iframe { pointer-events: auto; }
    .timeline-line { position: absolute; left: 20px; top: 0; bottom: 0; width: 2px; background: #e2e8f0; z-index: 0; }
  </style>
</head>

<body class="bg-slate-50 text-gray-900 font-sans">

  <!-- ===== Nav ===== -->
  <nav class="bg-indigo-900 text-white p-4 sticky top-0 z-50 shadow-md">
    <div class="container mx-auto flex flex-wrap justify-between items-center gap-3">
      <div>
        <h1 class="font-bold text-lg tracking-tight"><span id="nav-title">Florida Trip 2026 ğŸŒ´</span></h1>
        <p class="text-[10px] text-indigo-300 italic"><span id="nav-subtitle">March 07 - March 14</span></p>
      </div>

      <div class="flex items-center gap-2">
        <select id="langSelect" class="bg-indigo-800 text-white text-sm rounded-lg p-2 outline-none border border-indigo-700 cursor-pointer focus:ring-2 focus:ring-sky-400">
          <option value="zh">ç¹é«”ä¸­æ–‡</option>
          <option value="en">English</option>
          <option value="es">EspaÃ±ol</option>
          <option value="ko">í•œêµ­ì–´</option>
          <option value="vi">Tiáº¿ng Viá»‡t</option>
        </select>

        <button id="copyTodayBtn" class="bg-emerald-600 hover:bg-emerald-500 p-2 rounded-lg text-sm transition">
          <i class="fa-solid fa-copy"></i> <span id="copyTodayLabel">è¤‡è£½ä»Šå¤©è¡Œç¨‹</span>
        </button>

        <button id="exportIcsBtn" class="bg-indigo-700 hover:bg-indigo-600 p-2 rounded-lg text-sm transition">
          <i class="fa-solid fa-calendar-plus"></i> <span id="exportIcsLabel">åŒ¯å‡º .ics</span>
        </button>

        <button id="shareBtn" class="bg-indigo-600 hover:bg-indigo-500 p-2 rounded-lg text-sm transition" title="Copy share link">
          <i class="fa-solid fa-share-nodes"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- ===== Map ===== -->
  <div class="w-full h-80 md:h-96 bg-gray-200 border-b-4 border-indigo-900 shadow-inner">
    <iframe
      id="mapFrame"
      src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d3647686.1739013236!2d-82.142046!3d27.816585!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1szh-TW!2sus!4v1700000000000"
      width="100%"
      height="100%"
      style="border:0;"
      allowfullscreen=""
      loading="lazy">
    </iframe>
  </div>

  <!-- ===== Page ===== -->
  <main class="container mx-auto px-4 py-10 max-w-5xl">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
      <!-- Info card -->
      <div class="lg:col-span-1 bg-white rounded-3xl border border-slate-200 shadow-sm p-5">
        <div class="flex items-start justify-between gap-2 mb-3">
          <h2 class="font-bold text-indigo-900 text-lg" id="tripInfoTitle">è¡Œç¨‹è³‡è¨Š</h2>
          <span class="text-[11px] text-gray-500" id="lastUpdatedBadge">æœ€å¾Œæ›´æ–°ï¼šâ€”</span>
        </div>

        <div id="infoBox" class="text-sm space-y-2"></div>

        <!-- Expenses -->
        <div class="mt-5 border-t pt-4">
          <div class="flex items-center justify-between">
            <h3 class="font-bold text-indigo-900" id="expensesTitle">Expensesï¼ˆèŠ±è²»è¡¨ï¼‰</h3>
            <button id="toggleExpensesBtn" class="text-sm text-indigo-700 font-semibold hover:underline">
              <span id="toggleExpensesLabel">å±•é–‹</span>
            </button>
          </div>

          <div id="expensesPanel" class="hidden mt-3">
            <div class="flex items-center gap-2 mb-3 flex-wrap">
              <label class="text-xs text-gray-600" id="splitLabel">åˆ†å¸³äººæ•¸</label>
              <input id="splitPeople" type="number" min="1" value="2" class="w-20 text-sm rounded border px-2 py-1"/>
              <span class="text-xs text-gray-600" id="currencyLabel">å¹£åˆ¥</span>
              <select id="currencySelect" class="text-sm rounded border px-2 py-1">
                <option value="USD">USD</option>
                <option value="TWD">TWD</option>
                <option value="EUR">EUR</option>
              </select>
            </div>

            <div class="overflow-x-auto">
              <table class="w-full text-sm border rounded-xl overflow-hidden">
                <thead class="bg-indigo-50">
                  <tr>
                    <th class="text-left p-2 border" id="expDayCol">Day</th>
                    <th class="text-right p-2 border" id="expTicketsCol">é–€ç¥¨</th>
                    <th class="text-right p-2 border" id="expHotelCol">ä½å®¿</th>
                    <th class="text-right p-2 border" id="expCarCol">ç§Ÿè»Š</th>
                    <th class="text-right p-2 border" id="expGasCol">æ²¹éŒ¢</th>
                    <th class="text-right p-2 border" id="expParkingCol">åœè»Š</th>
                    <th class="text-right p-2 border" id="expFoodCol">é¤è²»</th>
                    <th class="text-right p-2 border" id="expMiscCol">å…¶ä»–</th>
                    <th class="text-right p-2 border" id="expTotalCol">å°è¨ˆ</th>
                  </tr>
                </thead>
                <tbody id="expensesTableBody" class="bg-white"></tbody>
                <tfoot class="bg-indigo-50">
                  <tr>
                    <td class="p-2 border font-bold" id="expGrandLabel">ç¸½è¨ˆ</td>
                    <td class="p-2 border text-right font-bold" colspan="7" id="expGrandValue">â€”</td>
                    <td class="p-2 border text-right font-bold" id="expGrandTotalCell">â€”</td>
                  </tr>
                  <tr>
                    <td class="p-2 border font-bold" id="expSplitLabel">æ¯äºº</td>
                    <td class="p-2 border text-right font-bold" colspan="8" id="expSplitValue">â€”</td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <div class="mt-2 text-xs text-gray-500" id="expNote">
              ä½ å¯ä»¥ç›´æ¥åœ¨è¡¨æ ¼è£¡æ”¹æ•¸å­—ï¼Œæœƒè‡ªå‹•å­˜åˆ°æœ¬æ©Ÿï¼ˆåŒä¸€å°è£ç½®/ç€è¦½å™¨æœ‰æ•ˆï¼‰ã€‚
            </div>
          </div>
        </div>
      </div>

      <!-- Timeline -->
      <div class="lg:col-span-2 relative">
        <div class="timeline-line hidden md:block"></div>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-indigo-900" id="itineraryTitle">ğŸ“Œ è¡Œç¨‹ï¼ˆé»æ¯å¤©å¯æ”¶åˆï¼‰</h2>
          <div class="text-xs text-gray-500" id="itineraryTip">æç¤ºï¼šé» Day æ¨™é¡Œå¯æ”¶åˆï¼›ä»Šå¤©æœƒè‡ªå‹•é«˜äº®ï¼›IMPORTANT æœƒè‡ªå‹•æäº®ã€‚</div>
        </div>
        <div id="daysContainer" class="space-y-4 relative z-10"></div>
      </div>
    </div>

    <!-- Footer -->
    <div class="mt-10 p-8 bg-white rounded-3xl border border-slate-200 shadow-sm border-t-4 border-t-indigo-600">
      <h3 class="font-bold text-indigo-900 mb-2 flex items-center gap-2 text-lg">
        <i class="fa-solid fa-car-side"></i> <span id="footerTitle">ç§Ÿè»Šèˆ‡äº¤é€šæé†’</span>
      </h3>
      <p class="text-gray-600 text-sm leading-relaxed" id="footerDesc">
        å»ºè­°ï¼šMIA å–è»Šã€MCO é‚„è»Šï¼ˆone-wayï¼‰ã€‚è·¯ç·šï¼šMiami â†’ Orlandoï¼ˆç’°çƒ/EPICï¼‰â†’ 3/12 KSC â†’ 3/13 Silver Springs â†’ 3/14 MCO é£›å› SATã€‚
      </p>
    </div>
  </main>

  <script>
    // ===== Trip config =====
    const TRIP_YEAR = 2026;
    const LAST_UPDATED_ISO = "2026-02-10T00:00:00-06:00";

    // ===== Data =====
    const tripData = {
      days: [
        // Day 1 - 3/07 SAT -> MIA, South Beach
        {
          id: "d1",
          month: 3, day: 7,
          label: "3/07 (Sat)",
          title: "SAT â†’ é‚é˜¿å¯†ï¼ˆMIAï¼‰ï¼‹å—æµ·ç˜",
          reminders: [
            { level: "important", text: "æŠµé” MIA å¾Œå–è»Šï¼Œå¸‚å€åœè»Šè¼ƒè²´ï¼šç›¡é‡é¸æœ‰åœè»Šä½/å«åœè»Šçš„ä½å®¿" },
            { level: "info", text: "æ™šä¸Š South Beach + Ocean Drive æ•£æ­¥å¾ˆèˆ’æœ" }
          ],
          stops: [
            {
              start: "12:00", end: "14:00",
              name: "é£›è¡Œï¼šSan Antonio (SAT) â†’ Miami (MIA)",
              address: "SAT â†’ MIA",
              phone: "",
              map: "https://www.google.com/maps/search/?api=1&query=Miami%20International%20Airport",
              note: "æ™‚é–“å¯ä¾ä½ çš„èˆªç­èª¿æ•´ï¼ˆé€™è£¡å…ˆæ”¾ç¯„ä¾‹æ™‚æ®µï¼‰ã€‚"
            },
            {
              travel: "30â€“60 min",
              start: "14:00", end: "15:00",
              name: "MIA å–è»Š + å‰å¾€é£¯åº—",
              address: "Miami International Airport, 2100 NW 42nd Ave, Miami, FL 33142",
              phone: "+1 305-876-7000",
              map: "https://maps.google.com/?q=Miami+International+Airport",
              note: "å»ºè­°å…ˆè²·æ°´/é›¶é£Ÿï¼Œç¢ºèªé«˜é€Ÿå…¬è·¯ tollï¼ˆé›»å­æ”¶è²»ï¼‰è¨­å®šã€‚"
            },
            {
              travel: "20â€“30 min",
              start: "17:30", end: "20:30",
              name: "South Beachï¼ˆå—æµ·ç˜ï¼‰+ Ocean Drive",
              address: "Ocean Dr, Miami Beach, FL 33139",
              phone: "",
              map: "https://maps.google.com/?q=South+Beach+Miami",
              note: "å¤•é™½æ•£æ­¥ + æ™šé¤ï¼›åœè»Šå¯ç”¨é™„è¿‘ public parking garageã€‚"
            }
          ],
          expenses: { tickets: 0, hotel: 220, car: 75, gas: 10, parking: 25, food: 90, misc: 10 }
        },

        // Day 2 - 3/08 Everglades
        {
          id: "d2",
          month: 3, day: 8,
          label: "3/08 (Sun)",
          title: "å¤§æ²¼æ¾¤ Evergladesï¼ˆShark Valleyï¼‰",
          reminders: [
            { level: "important", text: "é˜²æ›¬ï¼‹æ°´ï¼‹å¸½å­ï¼›æ—©åˆ°æ¯”è¼ƒä¸æ’éšŠ" }
          ],
          stops: [
            {
              start: "09:00", end: "12:30",
              name: "Shark Valley Visitor Center",
              address: "36000 SW 8th St, Miami, FL 33194",
              phone: "+1 305-221-8776",
              map: "https://maps.google.com/?q=Shark+Valley+Visitor+Center",
              note: "å¯ç§Ÿè…³è¸è»Šï¼æ­ Tramï¼›å¾ˆå®¹æ˜“çœ‹åˆ°é±·é­šã€‚"
            },
            {
              travel: "45â€“70 min",
              start: "16:00", end: "18:30",
              name: "å› Miami è‡ªç”±æ´»å‹•ï¼ˆLittle Havana å¯é¸ï¼‰",
              address: "Little Havana, Miami, FL",
              phone: "",
              map: "https://maps.google.com/?q=Little+Havana+Miami",
              note: "å’–å•¡ï¼‹å¤å·´é¢¨æƒ…è¡—å€ã€‚"
            }
          ],
          expenses: { tickets: 35, hotel: 220, car: 75, gas: 20, parking: 15, food: 85, misc: 10 }
        },

        // Day 3 - 3/09 Gulf Stream experience + drive to Orlando
        {
          id: "d3",
          month: 3, day: 9,
          label: "3/09 (Mon)",
          title: "å¢¨è¥¿å“¥ç£æš–æµï¼ˆGulf Streamï¼‰é«”é©—ï¼‹é–‹å»å¥§è˜­å¤š",
          reminders: [
            { level: "important", text: "ä»Šå¤©æœƒç§»å‹•è¼ƒå¤šï¼šå»ºè­°æ—©å‡ºç™¼ï¼Œæ™šä¸ŠæŠµé” Orlando" },
            { level: "info", text: "Gulf Stream æœ€æœ‰æ„Ÿé€šå¸¸æ˜¯ Palm Beach/Jupiter ä¸€å¸¶å‡ºæµ·æˆ–æµ®æ½›" }
          ],
          stops: [
            {
              start: "09:00", end: "10:30",
              name: "è‡ªé§•ï¼šMiami â†’ West Palm Beach",
              address: "Miami to West Palm Beach",
              phone: "",
              map: "https://maps.google.com/?q=Miami+to+West+Palm+Beach",
              note: "è»Šç¨‹ç´„ 1.5 å°æ™‚ï¼ˆçœ‹äº¤é€šï¼‰ã€‚"
            },
            {
              travel: "15â€“25 min",
              start: "11:30", end: "14:30",
              name: "Gulf Stream è¿‘æµ·é«”é©—ï¼ˆæµ®æ½›/å‡ºæµ·ï¼Œæ“‡ä¸€ï¼‰",
              address: "Phil Foster Park / Peanut Islandï¼ˆPalm Beachï¼‰",
              phone: "",
              map: "https://maps.google.com/?q=Phil+Foster+Park",
              note: "å¦‚æœä½ å…¶å¯¦æŒ‡çš„æ˜¯ Gulfstream Parkï¼ˆè³½é¦¬å ´/å¨›æ¨‚åŸï¼‰ï¼Œè·Ÿæˆ‘èªªæˆ‘å¯æ”¹æˆ Hallandale Beach è¡Œç¨‹ã€‚"
            },
            {
              travel: "2.5â€“3 hr",
              start: "16:30", end: "19:30",
              name: "è‡ªé§•ï¼šWest Palm Beach â†’ Orlando",
              address: "West Palm Beach to Orlando",
              phone: "",
              map: "https://maps.google.com/?q=West+Palm+Beach+to+Orlando",
              note: "æŠµé”å¾Œå…¥ä½ï¼Œç‚ºéš”å¤©ç’°çƒåšæº–å‚™ã€‚"
            }
          ],
          expenses: { tickets: 60, hotel: 180, car: 75, gas: 35, parking: 10, food: 85, misc: 15 }
        },

        // Day 4 - 3/10 Universal
        {
          id: "d4",
          month: 3, day: 10,
          label: "3/10 (Tue)",
          title: "ç’°çƒå½±åŸ Universal Orlandoï¼ˆç©æ•´å¤©ï¼‰",
          reminders: [
            { level: "important", text: "æƒ³æ­éœæ ¼è¯èŒ²ç‰¹å¿«è»Šéœ€ Park-to-Park ç¥¨" },
            { level: "important", text: "å»ºè­°é–‹åœ’å°±åˆ°ï¼ˆæ’éšŠå·®å¾ˆå¤šï¼‰" }
          ],
          stops: [
            {
              start: "09:00", end: "19:00",
              name: "Universal Orlando Resortï¼ˆStudios + Islands of Adventureï¼‰",
              address: "6000 Universal Blvd, Orlando, FL 32819",
              phone: "+1 407-363-8000",
              map: "https://www.universalorlando.com/web/en/us",
              note: "å¦‚æœåªæƒ³ç©å…¶ä¸­ä¸€åœ’å¯èª¿æ•´ï¼›æ­¤è™•ä»¥æ•´å¤©å®‰æ’ã€‚"
            }
          ],
          expenses: { tickets: 220, hotel: 180, car: 75, gas: 10, parking: 30, food: 95, misc: 15 }
        },

        // Day 5 - 3/11 Epic Universe
        {
          id: "d5",
          month: 3, day: 11,
          label: "3/11 (Wed)",
          title: "Epic Universeï¼ˆç©æ•´å¤©ï¼‰",
          reminders: [
            { level: "important", text: "æ–°åœ’å€äººæ½®å¾ˆçŒ›ï¼šrope dropï¼ˆé–‹åœ’è¡ç¬¬ä¸€æ³¢ï¼‰" }
          ],
          stops: [
            {
              start: "09:00", end: "19:00",
              name: "Universal Epic Universe",
              address: "Orlando, FLï¼ˆæ–°åœ’å€ï¼‰",
              phone: "",
              map: "https://www.universalorlando.com/web/en/us/theme-parks/epic-universe",
              note: "å…ˆæ’å¿…ç©æ¸…å–®ï¼šä»»å¤©å ‚/é­”æ³•éƒ¨ç­‰ã€‚"
            }
          ],
          expenses: { tickets: 210, hotel: 180, car: 75, gas: 10, parking: 30, food: 95, misc: 15 }
        },

        // Day 6 - 3/12 KSC fixed
        {
          id: "d6",
          month: 3, day: 12,
          label: "3/12 (Thu)",
          title: "è‚¯å°¼è¿ªèˆªå¤©ä¸­å¿ƒï¼ˆKSCï¼‰â€” å›ºå®š 3/12",
          reminders: [
            { level: "important", text: "Bus Tour å¯èƒ½é¡æ»¿ï¼šè¶Šæ—©åˆ°è¶Šå¥½" }
          ],
          stops: [
            {
              start: "08:30", end: "09:30",
              name: "è‡ªé§•ï¼šOrlando â†’ Kennedy Space Center",
              address: "Orlando to Merritt Island",
              phone: "",
              map: "https://maps.google.com/?q=Orlando+to+Kennedy+Space+Center",
              note: "è»Šç¨‹ç´„ 1 å°æ™‚ï¼ˆçœ‹äº¤é€šï¼‰ã€‚"
            },
            {
              start: "10:00", end: "17:00",
              name: "Kennedy Space Center Visitor Complex",
              address: "Space Commerce Way, Merritt Island, FL 32953",
              phone: "+1 855-433-4210",
              map: "https://www.kennedyspacecenter.com/",
              note: "Rocket Garden / Atlantis / Bus Tourï¼ˆå»ºè­°å…ˆæ¶ Bus Tourï¼‰ã€‚"
            },
            {
              travel: "1 hr",
              start: "17:30", end: "18:30",
              name: "å› Orlando",
              address: "Orlando, FL",
              phone: "",
              map: "https://maps.google.com/?q=Orlando",
              note: "æ™šé¤ï¼‹ä¼‘æ¯ã€‚"
            }
          ],
          expenses: { tickets: 170, hotel: 180, car: 75, gas: 25, parking: 15, food: 85, misc: 10 }
        },

        // Day 7 - 3/13 Silver Springs
        {
          id: "d7",
          month: 3, day: 13,
          label: "3/13 (Fri)",
          title: "Silver Springsï¼ˆç»ç’ƒèˆ¹/æ¸…æ³‰ï¼‰ä¸€æ—¥",
          reminders: [
            { level: "important", text: "å¸¶é˜²èšŠæ¶²ï¼›æ¸…æ³‰å€æ—©æ™šæº«å·®è¼ƒå¤§å¯å¸¶è–„å¤–å¥—" }
          ],
          stops: [
            {
              start: "09:00", end: "10:30",
              name: "è‡ªé§•ï¼šOrlando â†’ Silver Springs State Park",
              address: "1425 NE 58th Ave, Ocala, FL 34470",
              phone: "+1 352-236-7148",
              map: "https://maps.google.com/?q=Silver+Springs+State+Park",
              note: "è»Šç¨‹ç´„ 1.5 å°æ™‚ã€‚"
            },
            {
              start: "11:00", end: "14:00",
              name: "Glass Bottom Boatï¼ˆç»ç’ƒèˆ¹ï¼Œå»ºè­°ï¼‰",
              address: "Silver Springs State Park",
              phone: "",
              map: "https://maps.google.com/?q=Silver+Springs+Glass+Bottom+Boat",
              note: "è¡Œç¨‹ä¾ç•¶å¤©ç­æ¬¡èª¿æ•´ï¼›ä¹Ÿå¯æ”¹æˆåˆ’èˆ¹/æ­¥é“ã€‚"
            },
            {
              travel: "1.5 hr",
              start: "16:00", end: "17:30",
              name: "å› Orlandoï¼ˆæ•´ç†è¡Œæï¼‰",
              address: "Orlando, FL",
              phone: "",
              map: "https://maps.google.com/?q=Orlando",
              note: "æ˜å¤©è¦é£›ï¼Œå»ºè­°æ—©é»ä¼‘æ¯ã€‚"
            }
          ],
          expenses: { tickets: 20, hotel: 180, car: 75, gas: 20, parking: 10, food: 90, misc: 10 }
        },

        // Day 8 - 3/14 fly back from MCO
        {
          id: "d8",
          month: 3, day: 14,
          label: "3/14 (Sat)",
          title: "MCO â†’ SAT å›ç¨‹ï¼ˆé‚„è»Šï¼‹ç™»æ©Ÿï¼‰",
          reminders: [
            { level: "important", text: "é‚„è»Šï¼‹å®‰æª¢è¦ç•™ç·©è¡ï¼ˆå»ºè­°èµ·é£›å‰ 2.5~3 å°æ™‚åˆ°æ©Ÿå ´ï¼‰" }
          ],
          stops: [
            {
              start: "09:30", end: "11:00",
              name: "Orlando International Airportï¼ˆMCOï¼‰é‚„è»Šï¼‹è¾¦ç†ç™»æ©Ÿ",
              address: "1 Jeff Fuqua Blvd, Orlando, FL 32827",
              phone: "+1 407-825-2001",
              map: "https://maps.google.com/?q=Orlando+International+Airport",
              note: "è‹¥ä½ æœ€å¾Œè¦å¾ MIA é£›å›ï¼Œä¹Ÿå¯ä»¥æŠŠé€™å¤©æ”¹æˆ Orlando â†’ Miami æ—©ç§»å‹•ã€‚"
            },
            {
              start: "12:00", end: "14:30",
              name: "é£›è¡Œï¼šOrlando (MCO) â†’ San Antonio (SAT)",
              address: "MCO â†’ SAT",
              phone: "",
              map: "https://www.google.com/maps/search/?api=1&query=San%20Antonio%20International%20Airport",
              note: "æ™‚é–“ä¾ä½ çš„èˆªç­èª¿æ•´ï¼ˆé€™è£¡å…ˆæ”¾ç¯„ä¾‹æ™‚æ®µï¼‰ã€‚"
            }
          ],
          expenses: { tickets: 0, hotel: 0, car: 75, gas: 10, parking: 0, food: 40, misc: 0 }
        }
      ]
    };

    // ===== Translations (FULL, not fallback) =====
    const translations = {
      zh: {
        page_title: "Florida Trip 2026 | Josephine",
        nav_title: "Florida Trip 2026 ğŸŒ´",
        nav_subtitle: "March 07 - March 14",
        trip_info: "è¡Œç¨‹è³‡è¨Š",
        itinerary_title: "ğŸ“Œ è¡Œç¨‹ï¼ˆé»æ¯å¤©å¯æ”¶åˆï¼‰",
        itinerary_tip: "æç¤ºï¼šé» Day æ¨™é¡Œå¯æ”¶åˆï¼›ä»Šå¤©æœƒè‡ªå‹•é«˜äº®ï¼›IMPORTANT æœƒè‡ªå‹•æäº®ã€‚",
        share_label: "åˆ†äº«é€£çµï¼ˆGitHub Pagesï¼‰",
        share_placeholder: "è²¼ä¸Š GitHub Pages é€£çµï¼ˆæˆ–ç•™ç©º=è¤‡è£½ç›®å‰é é¢ï¼‰",
        share_hint: "æç¤ºï¼šè²¼ä¸Šä½ çš„ GitHub Pages ç¶²å€ï¼Œæˆ–ç•™ç©ºç›´æ¥è¤‡è£½ç›®å‰é é¢ã€‚",
        share_msg: "å·²è¤‡è£½é€£çµï¼",
        copy_today: "è¤‡è£½ä»Šå¤©è¡Œç¨‹",
        copy_day: "è¤‡è£½æœ¬æ—¥",
        export_ics: "åŒ¯å‡º .ics",
        export_ics_all: "åŒ¯å‡ºæ•´è¶Ÿ .ics",
        export_ics_today: "åŒ¯å‡ºä»Šæ—¥ .ics",
        export_ics_done: "å·²ç”¢ç”Ÿ .ics æª”æ¡ˆ",
        day_expand: "å±•é–‹",
        day_collapse: "æ”¶åˆ",
        last_updated: "æœ€å¾Œæ›´æ–°ï¼š",
        stop_address: "åœ°å€",
        stop_phone: "é›»è©±",
        open_map: "ä¸€éµé–‹åœ°åœ–",
        notes: "å‚™è¨»",
        reminders: "é‡é»æé†’",
        travel_time: "äº¤é€šæ™‚é–“",
        expenses: "Expensesï¼ˆèŠ±è²»è¡¨ï¼‰",
        expenses_toggle_open: "å±•é–‹",
        expenses_toggle_close: "æ”¶åˆ",
        split_people: "åˆ†å¸³äººæ•¸",
        currency: "å¹£åˆ¥",
        exp_cols: { day: "Day", tickets: "é–€ç¥¨", hotel: "ä½å®¿", car: "ç§Ÿè»Š", gas: "æ²¹éŒ¢", parking: "åœè»Š", food: "é¤è²»", misc: "å…¶ä»–", total: "å°è¨ˆ" },
        exp_grand: "ç¸½è¨ˆ",
        exp_per_person: "æ¯äºº",
        exp_note: "ä½ å¯ä»¥ç›´æ¥åœ¨è¡¨æ ¼è£¡æ”¹æ•¸å­—ï¼Œæœƒè‡ªå‹•å­˜åˆ°æœ¬æ©Ÿï¼ˆåŒä¸€å°è£ç½®/ç€è¦½å™¨æœ‰æ•ˆï¼‰ã€‚",
        footer_title: "ç§Ÿè»Šèˆ‡äº¤é€šæé†’",
        footer_desc: "å»ºè­°ï¼šMIA å–è»Šã€MCO é‚„è»Šï¼ˆone-wayï¼‰ã€‚è·¯ç·šï¼šMiami â†’ Orlandoï¼ˆç’°çƒ/EPICï¼‰â†’ 3/12 KSC â†’ 3/13 Silver Springs â†’ 3/14 MCO é£›å› SATã€‚"
      },
      en: {
        page_title: "Florida Trip 2026 | Josephine",
        nav_title: "Florida Trip 2026 ğŸŒ´",
        nav_subtitle: "March 07 - March 14",
        trip_info: "Trip Info",
        itinerary_title: "ğŸ“Œ Itinerary (tap day to expand/collapse)",
        itinerary_tip: "Tip: tap a Day header to expand/collapse. Today is auto-highlighted; IMPORTANT reminders are emphasized.",
        share_label: "Share link (GitHub Pages)",
        share_placeholder: "Paste GitHub Pages link (or leave blank to copy this page)",
        share_hint: "Tip: paste your GitHub Pages URL, or leave blank to copy this page.",
        share_msg: "Link copied!",
        copy_today: "Copy today",
        copy_day: "Copy this day",
        export_ics: "Export .ics",
        export_ics_all: "Export full trip .ics",
        export_ics_today: "Export today .ics",
        export_ics_done: ".ics generated",
        day_expand: "Expand",
        day_collapse: "Collapse",
        last_updated: "Last updated: ",
        stop_address: "Address",
        stop_phone: "Phone",
        open_map: "Open map",
        notes: "Notes",
        reminders: "Reminders",
        travel_time: "Travel time",
        expenses: "Expenses",
        expenses_toggle_open: "Open",
        expenses_toggle_close: "Close",
        split_people: "Split",
        currency: "Currency",
        exp_cols: { day: "Day", tickets: "Tickets", hotel: "Hotel", car: "Car", gas: "Gas", parking: "Parking", food: "Food", misc: "Misc", total: "Total" },
        exp_grand: "Grand Total",
        exp_per_person: "Per person",
        exp_note: "You can edit numbers in the table; they are saved locally in this browser.",
        footer_title: "Rental Car & Transportation",
        footer_desc: "Recommended: pick up at MIA and drop off at MCO (one-way). Route: Miami â†’ Orlando (Universal/EPIC) â†’ Mar 12 KSC â†’ Mar 13 Silver Springs â†’ Mar 14 fly MCO â†’ SAT."
      },
      es: {
        page_title: "Viaje Florida 2026 | Josephine",
        nav_title: "Florida Trip 2026 ğŸŒ´",
        nav_subtitle: "07 Mar - 14 Mar",
        trip_info: "Info del viaje",
        itinerary_title: "ğŸ“Œ Itinerario (toca el dÃ­a para abrir/cerrar)",
        itinerary_tip: "Consejo: toca el encabezado del dÃ­a para abrir/cerrar. Hoy se resalta automÃ¡ticamente; los IMPORTANT se destacan.",
        share_label: "Compartir enlace (GitHub Pages)",
        share_placeholder: "Pega el enlace de GitHub Pages (o dÃ©jalo vacÃ­o para copiar esta pÃ¡gina)",
        share_hint: "Consejo: pega la URL de GitHub Pages o dÃ©jalo vacÃ­o para copiar esta pÃ¡gina.",
        share_msg: "Â¡Enlace copiado!",
        copy_today: "Copiar hoy",
        copy_day: "Copiar este dÃ­a",
        export_ics: "Exportar .ics",
        export_ics_all: "Exportar viaje completo .ics",
        export_ics_today: "Exportar hoy .ics",
        export_ics_done: ".ics generado",
        day_expand: "Abrir",
        day_collapse: "Cerrar",
        last_updated: "Ãšltima actualizaciÃ³n: ",
        stop_address: "DirecciÃ³n",
        stop_phone: "TelÃ©fono",
        open_map: "Abrir mapa",
        notes: "Notas",
        reminders: "Recordatorios",
        travel_time: "Tiempo de traslado",
        expenses: "Gastos",
        expenses_toggle_open: "Abrir",
        expenses_toggle_close: "Cerrar",
        split_people: "Dividir",
        currency: "Moneda",
        exp_cols: { day: "DÃ­a", tickets: "Entradas", hotel: "Hotel", car: "Coche", gas: "Gasolina", parking: "Parking", food: "Comida", misc: "Otros", total: "Total" },
        exp_grand: "Total",
        exp_per_person: "Por persona",
        exp_note: "Puedes editar nÃºmeros en la tabla; se guardan localmente en este navegador.",
        footer_title: "Alquiler y transporte",
        footer_desc: "Recomendado: recoger en MIA y devolver en MCO (one-way). Ruta: Miami â†’ Orlando (Universal/EPIC) â†’ 12 Mar KSC â†’ 13 Mar Silver Springs â†’ 14 Mar vuelo MCO â†’ SAT."
      },
      ko: {
        page_title: "í”Œë¡œë¦¬ë‹¤ ì—¬í–‰ 2026 | Josephine",
        nav_title: "Florida Trip 2026 ğŸŒ´",
        nav_subtitle: "3ì›” 7ì¼ - 3ì›” 14ì¼",
        trip_info: "ì—¬í–‰ ì •ë³´",
        itinerary_title: "ğŸ“Œ ì¼ì • (Dayë¥¼ ëˆŒëŸ¬ ì ‘ê¸°/í¼ì¹˜ê¸°)",
        itinerary_tip: "íŒ: Day í—¤ë”ë¥¼ ëˆŒëŸ¬ ì ‘ê¸°/í¼ì¹˜ê¸°. ì˜¤ëŠ˜ ì¼ì •ì€ ìë™ í•˜ì´ë¼ì´íŠ¸; IMPORTANT ì•Œë¦¼ì€ ê°•ì¡°ë©ë‹ˆë‹¤.",
        share_label: "ê³µìœ  ë§í¬ (GitHub Pages)",
        share_placeholder: "GitHub Pages ë§í¬ë¥¼ ë¶™ì—¬ë„£ê¸° (ë¹„ìš°ë©´ í˜„ì¬ í˜ì´ì§€ ë§í¬ ë³µì‚¬)",
        share_hint: "íŒ: GitHub Pages URLì„ ë¶™ì—¬ë„£ê±°ë‚˜ ë¹„ìš°ë©´ í˜„ì¬ í˜ì´ì§€ ë§í¬ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.",
        share_msg: "ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!",
        copy_today: "ì˜¤ëŠ˜ ì¼ì • ë³µì‚¬",
        copy_day: "ì´ ë‚  ë³µì‚¬",
        export_ics: ".ics ë‚´ë³´ë‚´ê¸°",
        export_ics_all: "ì „ì²´ ì—¬í–‰ .ics",
        export_ics_today: "ì˜¤ëŠ˜ .ics",
        export_ics_done: ".ics ìƒì„±ë¨",
        day_expand: "í¼ì¹˜ê¸°",
        day_collapse: "ì ‘ê¸°",
        last_updated: "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ",
        stop_address: "ì£¼ì†Œ",
        stop_phone: "ì „í™”",
        open_map: "ì§€ë„ ì—´ê¸°",
        notes: "ë©”ëª¨",
        reminders: "ì¤‘ìš” ì•Œë¦¼",
        travel_time: "ì´ë™ ì‹œê°„",
        expenses: "ë¹„ìš©",
        expenses_toggle_open: "ì—´ê¸°",
        expenses_toggle_close: "ë‹«ê¸°",
        split_people: "ë¶„í• ",
        currency: "í†µí™”",
        exp_cols: { day: "Day", tickets: "í‹°ì¼“", hotel: "ìˆ™ë°•", car: "ë ŒíŠ¸", gas: "ì£¼ìœ ", parking: "ì£¼ì°¨", food: "ì‹ë¹„", misc: "ê¸°íƒ€", total: "í•©ê³„" },
        exp_grand: "ì´í•©",
        exp_per_person: "1ì¸",
        exp_note: "í‘œì—ì„œ ìˆ«ìë¥¼ ìˆ˜ì •í•˜ë©´ ì´ ë¸Œë¼ìš°ì €ì— ë¡œì»¬ ì €ì¥ë©ë‹ˆë‹¤.",
        footer_title: "ë Œí„°ì¹´ & ì´ë™ ì•ˆë‚´",
        footer_desc: "ì¶”ì²œ: MIAì—ì„œ í”½ì—…í•˜ê³  MCOì—ì„œ ë°˜ë‚©(one-way). ë£¨íŠ¸: Miami â†’ Orlando(Universal/EPIC) â†’ 3/12 KSC â†’ 3/13 Silver Springs â†’ 3/14 MCO â†’ SAT."
      },
      vi: {
        page_title: "Chuyáº¿n Ä‘i Florida 2026 | Josephine",
        nav_title: "Florida Trip 2026 ğŸŒ´",
        nav_subtitle: "07 Mar - 14 Mar",
        trip_info: "ThÃ´ng tin chuyáº¿n Ä‘i",
        itinerary_title: "ğŸ“Œ Lá»‹ch trÃ¬nh (cháº¡m Ä‘á»ƒ má»Ÿ/Ä‘Ã³ng ngÃ y)",
        itinerary_tip: "Gá»£i Ã½: cháº¡m tiÃªu Ä‘á» ngÃ y Ä‘á»ƒ má»Ÿ/Ä‘Ã³ng. HÃ´m nay sáº½ Ä‘Æ°á»£c tÃ´ sÃ¡ng; IMPORTANT sáº½ Ä‘Æ°á»£c nháº¥n máº¡nh.",
        share_label: "LiÃªn káº¿t chia sáº» (GitHub Pages)",
        share_placeholder: "DÃ¡n link GitHub Pages (hoáº·c Ä‘á»ƒ trá»‘ng Ä‘á»ƒ copy trang nÃ y)",
        share_hint: "Gá»£i Ã½: dÃ¡n URL GitHub Pages hoáº·c Ä‘á»ƒ trá»‘ng Ä‘á»ƒ copy trang nÃ y.",
        share_msg: "ÄÃ£ sao chÃ©p liÃªn káº¿t!",
        copy_today: "Copy hÃ´m nay",
        copy_day: "Copy ngÃ y nÃ y",
        export_ics: "Xuáº¥t .ics",
        export_ics_all: "Xuáº¥t cáº£ chuyáº¿n .ics",
        export_ics_today: "Xuáº¥t hÃ´m nay .ics",
        export_ics_done: "ÄÃ£ táº¡o .ics",
        day_expand: "Má»Ÿ",
        day_collapse: "ÄÃ³ng",
        last_updated: "Cáº­p nháº­t: ",
        stop_address: "Äá»‹a chá»‰",
        stop_phone: "Äiá»‡n thoáº¡i",
        open_map: "Má»Ÿ báº£n Ä‘á»“",
        notes: "Ghi chÃº",
        reminders: "Nháº¯c nhá»Ÿ",
        travel_time: "Thá»i gian di chuyá»ƒn",
        expenses: "Chi phÃ­",
        expenses_toggle_open: "Má»Ÿ",
        expenses_toggle_close: "ÄÃ³ng",
        split_people: "Chia",
        currency: "Tiá»n tá»‡",
        exp_cols: { day: "NgÃ y", tickets: "VÃ©", hotel: "KhÃ¡ch sáº¡n", car: "ThuÃª xe", gas: "XÄƒng", parking: "Äá»— xe", food: "Ä‚n uá»‘ng", misc: "KhÃ¡c", total: "Tá»•ng" },
        exp_grand: "Tá»•ng cá»™ng",
        exp_per_person: "Má»—i ngÆ°á»i",
        exp_note: "Báº¡n cÃ³ thá»ƒ sá»­a sá»‘ trong báº£ng; dá»¯ liá»‡u sáº½ lÆ°u cá»¥c bá»™ trÃªn trÃ¬nh duyá»‡t nÃ y.",
        footer_title: "ThuÃª xe & di chuyá»ƒn",
        footer_desc: "Gá»£i Ã½: nháº­n xe táº¡i MIA vÃ  tráº£ xe táº¡i MCO (one-way). Lá»™ trÃ¬nh: Miami â†’ Orlando (Universal/EPIC) â†’ 12/3 KSC â†’ 13/3 Silver Springs â†’ 14/3 bay MCO â†’ SAT."
      }
    };

    // ===== Helpers =====
    function pad2(n){ return String(n).padStart(2,'0'); }

    function formatLastUpdated(lang) {
      const t = translations[lang] || translations.zh;
      try {
        const d = new Date(LAST_UPDATED_ISO);
        const y = d.getFullYear(), m = d.getMonth()+1, day = d.getDate();
        const hh = pad2(d.getHours()), mm = pad2(d.getMinutes());
        if (lang === "zh") return `${t.last_updated}${y}/${pad2(m)}/${pad2(day)} ${hh}:${mm}`;
        return `${t.last_updated}${y}-${pad2(m)}-${pad2(day)} ${hh}:${mm}`;
      } catch (e) {
        return (translations[lang]||translations.zh).last_updated + "â€”";
      }
    }

    function getTodayKey() {
      const now = new Date();
      return { year: now.getFullYear(), month: now.getMonth()+1, day: now.getDate() };
    }
    function dayKeyObj(dayObj) { return { year: TRIP_YEAR, month: dayObj.month, day: dayObj.day }; }
    function sameDate(a,b){ return a.year===b.year && a.month===b.month && a.day===b.day; }

    function minutesBetween(start, end) {
      const [sh, sm] = start.split(":").map(Number);
      const [eh, em] = end.split(":").map(Number);
      return (eh*60+em) - (sh*60+sm);
    }

    function humanDuration(mins, lang) {
      if (!Number.isFinite(mins) || mins <= 0) return "";
      if (lang === "zh") return `${mins} åˆ†é˜`;
      if (lang === "ko") return `${mins}ë¶„`;
      if (lang === "vi") return `${mins} phÃºt`;
      if (lang === "es") return `${mins} min`;
      return `${mins} min`;
    }

    // ===== Copy helpers =====
    function buildDayText(dayObj, lang) {
      const t = translations[lang] || translations.zh;
      const lines = [];
      lines.push(`${dayObj.label} Â· ${dayObj.title}`);
      lines.push(`- ${t.reminders}:`);
      (dayObj.reminders || []).forEach(r => lines.push(`  â€¢ ${r.text}`));
      lines.push("");
      dayObj.stops.forEach(s => {
        if (s.travel) lines.push(`ğŸš— ${t.travel_time}: ${s.travel}`);
        if (s.start && s.end) lines.push(`${s.start}-${s.end} ${s.name}`);
        else lines.push(`${s.name}`);
        if (s.address) lines.push(`  ğŸ“ ${s.address}`);
        if (s.map) lines.push(`  ğŸ—º ${s.map}`);
        if (s.phone) lines.push(`  â˜ ${s.phone}`);
        if (s.note) lines.push(`  ğŸ“ ${s.note}`);
        lines.push("");
      });
      return lines.join("\n").trim();
    }

    function getTodayOrFirstTripDay() {
      const today = getTodayKey();
      const match = tripData.days.find(d => sameDate(today, dayKeyObj(d)));
      return match || tripData.days[0];
    }

    async function copyTextToClipboard(text) {
      await navigator.clipboard.writeText(text);
    }

    // ===== ICS export =====
    function escapeIcs(s) {
      return String(s || "")
        .replace(/\\/g, "\\\\")
        .replace(/\n/g, "\\n")
        .replace(/,/g, "\\,")
        .replace(/;/g, "\\;");
    }

    function toIcsDateTimeLocal(year, month, day, hhmm) {
      const [h, m] = hhmm.split(":").map(Number);
      return `${year}${pad2(month)}${pad2(day)}T${pad2(h)}${pad2(m)}00`;
    }

    function buildIcs(events, filename="trip.ics") {
      const dtStamp = new Date().toISOString().replace(/[-:]/g,"").split(".")[0] + "Z";
      const lines = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//Trip Planner//EN",
        "CALSCALE:GREGORIAN",
        "METHOD:PUBLISH"
      ];
      for (const ev of events) {
        lines.push("BEGIN:VEVENT");
        lines.push(`UID:${ev.uid}`);
        lines.push(`DTSTAMP:${dtStamp}`);
        lines.push(`DTSTART:${ev.dtstart}`);
        lines.push(`DTEND:${ev.dtend}`);
        lines.push(`SUMMARY:${escapeIcs(ev.summary)}`);
        if (ev.location) lines.push(`LOCATION:${escapeIcs(ev.location)}`);
        if (ev.description) lines.push(`DESCRIPTION:${escapeIcs(ev.description)}`);
        lines.push("END:VEVENT");
      }
      lines.push("END:VCALENDAR");

      const blob = new Blob([lines.join("\r\n")], { type: "text/calendar;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function exportIcs(lang, onlyToday=false) {
      const t = translations[lang] || translations.zh;
      const days = onlyToday ? [getTodayOrFirstTripDay()] : tripData.days;

      const events = [];
      for (const d of days) {
        for (const s of d.stops) {
          if (!s.start || !s.end) continue;
          const uid = `${d.id}-${(s.name||"stop").replace(/\s+/g,"_")}-${s.start}`.slice(0,200);
          events.push({
            uid: uid + "@trip",
            dtstart: toIcsDateTimeLocal(TRIP_YEAR, d.month, d.day, s.start),
            dtend: toIcsDateTimeLocal(TRIP_YEAR, d.month, d.day, s.end),
            summary: s.name,
            location: s.address || "",
            description: (s.note || "") + (s.map ? `\nMap: ${s.map}` : "")
          });
        }
      }

      const filename = onlyToday ? `today_${TRIP_YEAR}.ics` : `trip_${TRIP_YEAR}.ics`;
      buildIcs(events, filename);
      alert(t.export_ics_done);
    }

    // ===== Expenses local storage =====
    const EXP_LS_KEY = "trip_expenses_v2";
    function loadExpenseOverrides() {
      try {
        const raw = localStorage.getItem(EXP_LS_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch (e) { return {}; }
    }
    function saveExpenseOverrides(obj) {
      try { localStorage.setItem(EXP_LS_KEY, JSON.stringify(obj)); } catch (e) {}
    }

    // ===== Rendering =====
    function renderInfo(lang) {
      const t = translations[lang] || translations.zh;
      document.getElementById("tripInfoTitle").innerText = t.trip_info;
      document.getElementById("lastUpdatedBadge").innerText = formatLastUpdated(lang);

      const infoItems = [
        { label: (lang==="zh" ? "èˆªç·š" : "Route"), value: "SAT â†’ MIA â†’ (drive) â†’ MCO â†’ SAT" },
        { label: (lang==="zh" ? "äº¤é€š" : "Transport"), value: (lang==="zh" ? "è‡ªé§•ï¼ˆç§Ÿè»Šï¼‰" : "Road trip (rental car)") },
        { label: (lang==="zh" ? "å¿…å»" : "Must-do"), value: "Everglades / South Beach / Gulf Stream / Universal / Epic / KSC (3/12) / Silver Springs" },
        { label: (lang==="zh" ? "é‚„è»Šå»ºè­°" : "Drop-off"), value: (lang==="zh" ? "MIA å–è»Šã€MCO é‚„è»Šï¼ˆone-wayï¼‰" : "Pick up MIA, drop off MCO (one-way)") }
      ];

      const infoBox = document.getElementById("infoBox");
      infoBox.innerHTML = infoItems.map(item => `
        <div class="flex justify-between gap-2">
          <span class="text-gray-500">${item.label}</span>
          <span class="font-semibold text-right">${item.value}</span>
        </div>
      `).join("");
    }

    function renderDays(lang) {
      const t = translations[lang] || translations.zh;
      const today = getTodayKey();
      const container = document.getElementById("daysContainer");
      container.innerHTML = "";

      tripData.days.forEach((d, idx) => {
        const isToday = sameDate(today, dayKeyObj(d));
        const expandedByDefault = isToday || idx === 0;

        const dayCard = document.createElement("div");
        dayCard.className = `bg-white rounded-3xl shadow-sm border p-0 relative overflow-hidden ${isToday ? "border-amber-300 ring-2 ring-amber-200" : "border-slate-100"}`;

        // header (accordion)
        const header = document.createElement("button");
        header.type = "button";
        header.className = "w-full text-left p-5 hover:bg-indigo-50 transition flex items-start justify-between gap-3";
        header.innerHTML = `
          <div class="relative z-10">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">${d.label}</span>
              ${isToday ? `<span class="text-[11px] bg-amber-100 text-amber-800 px-2 py-1 rounded-full"><i class="fa-solid fa-star"></i> Today</span>` : ""}
            </div>
            <h3 class="text-xl font-bold text-slate-800">${d.title}</h3>
            <div class="mt-2 flex flex-wrap gap-2">
              <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full">
                <i class="fa-solid fa-location-dot"></i> ${d.stops.length} stops
              </span>
            </div>
          </div>

          <div class="shrink-0 flex items-center gap-2">
            <button class="copyDayBtn bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl px-3 py-2 text-sm" data-dayid="${d.id}" type="button">
              <i class="fa-solid fa-copy"></i> <span class="copyDayLabel">${t.copy_day}</span>
            </button>
            <div class="text-indigo-700 font-semibold text-sm">
              <span class="dayToggleText">${expandedByDefault ? t.day_collapse : t.day_expand}</span>
              <i class="fa-solid fa-chevron-down ml-2 transition-transform dayChevron ${expandedByDefault ? "rotate-180" : ""}"></i>
            </div>
          </div>
        `;

        // body
        const body = document.createElement("div");
        body.className = `px-5 pb-5 ${expandedByDefault ? "" : "hidden"}`;

        // reminders (highlight important)
        const reminderBox = document.createElement("div");
        reminderBox.className = `mt-3 rounded-2xl border p-4 ${isToday ? "bg-amber-50 border-amber-200" : "bg-indigo-50 border-indigo-100"}`;
        reminderBox.innerHTML = `
          <div class="font-bold text-indigo-900 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-bell"></i> ${t.reminders}
          </div>
          <ul class="text-sm space-y-2">
            ${(d.reminders || []).map(r => {
              const isImp = r.level === "important";
              return `
                <li class="flex gap-2 items-start">
                  <span class="mt-2 inline-block w-2 h-2 rounded-full ${isImp ? "bg-amber-500" : "bg-indigo-500"}"></span>
                  <span class="inline-block px-2 py-[2px] rounded text-[11px] font-bold ${isImp ? "bg-amber-200 text-amber-900" : "bg-indigo-200 text-indigo-900"}">
                    ${isImp ? "IMPORTANT" : "INFO"}
                  </span>
                  <span class="${isImp ? "font-semibold text-amber-900" : "text-slate-700"}">${r.text}</span>
                </li>
              `;
            }).join("")}
          </ul>
        `;

        // stops
        const stopsWrap = document.createElement("div");
        stopsWrap.className = "mt-4 space-y-3";

        d.stops.forEach((s) => {
          if (s.travel) {
            const travel = document.createElement("div");
            travel.className = "flex items-center gap-2 text-xs text-gray-500 pl-2";
            travel.innerHTML = `<i class="fa-solid fa-car-side text-gray-400"></i> <span class="font-semibold">${t.travel_time}:</span> <span>${s.travel}</span>`;
            stopsWrap.appendChild(travel);
          }

          const stayMins = (s.start && s.end) ? minutesBetween(s.start, s.end) : null;

          const stopCard = document.createElement("div");
          stopCard.className = "bg-white rounded-2xl border border-slate-100 shadow-sm p-4";

          const mapBtn = s.map ? `<a href="${s.map}" target="_blank" class="text-indigo-700 font-semibold hover:underline"><i class="fa-solid fa-location-dot"></i> ${t.open_map}</a>` : "";
          const phoneLine = s.phone ? `
            <div class="text-xs text-gray-600">
              <span class="font-semibold">${t.stop_phone}:</span>
              <a href="tel:${String(s.phone).replace(/\s/g,'')}" class="text-indigo-700 hover:underline">${s.phone}</a>
            </div>` : "";

          stopCard.innerHTML = `
            <div class="flex items-start justify-between gap-2">
              <div>
                <div class="text-xs text-gray-500">
                  ${s.start && s.end ? `<span class="font-semibold">${s.start}â€“${s.end}</span> ${stayMins ? `Â· ${humanDuration(stayMins, lang)}` : ""}` : ""}
                </div>
                <div class="font-bold text-indigo-900">${s.name}</div>
              </div>
              <div class="text-xs">${mapBtn}</div>
            </div>

            ${s.note ? `<div class="mt-2 text-sm text-gray-700"><span class="font-semibold text-slate-500">${t.notes}:</span> ${s.note}</div>` : ""}

            <div class="mt-2 text-xs text-gray-600 space-y-1">
              ${s.address ? `<div><span class="font-semibold">${t.stop_address}:</span> ${s.address}</div>` : ""}
              ${phoneLine}
            </div>
          `;
          stopsWrap.appendChild(stopCard);
        });

        body.appendChild(reminderBox);
        body.appendChild(stopsWrap);

        // accordion toggle (but don't toggle when clicking "copy day" button)
        header.addEventListener("click", (ev) => {
          if (ev.target.closest(".copyDayBtn")) return;
          const isHidden = body.classList.contains("hidden");
          body.classList.toggle("hidden", !isHidden);
          header.querySelector(".dayToggleText").innerText = isHidden ? t.day_collapse : t.day_expand;
          header.querySelector(".dayChevron").classList.toggle("rotate-180", isHidden);
        });

        dayCard.appendChild(header);
        dayCard.appendChild(body);
        container.appendChild(dayCard);
      });

      // Wire up per-day copy buttons
      container.querySelectorAll(".copyDayBtn").forEach(btn => {
        btn.addEventListener("click", async (ev) => {
          ev.preventDefault();
          ev.stopPropagation();
          const dayId = btn.getAttribute("data-dayid");
          const dayObj = tripData.days.find(x => x.id === dayId);
          if (!dayObj) return;
          try {
            await copyTextToClipboard(buildDayText(dayObj, lang));
            alert((translations[lang]||translations.en).share_msg);
          } catch (e) {
            alert("Copy failed");
          }
        });
      });
    }

    // ===== Expenses =====
    function renderExpenses(lang) {
      const t = translations[lang] || translations.zh;

      document.getElementById("expensesTitle").innerText = t.expenses;
      document.getElementById("splitLabel").innerText = t.split_people;
      document.getElementById("currencyLabel").innerText = t.currency;

      document.getElementById("expDayCol").innerText = t.exp_cols.day;
      document.getElementById("expTicketsCol").innerText = t.exp_cols.tickets;
      document.getElementById("expHotelCol").innerText = t.exp_cols.hotel;
      document.getElementById("expCarCol").innerText = t.exp_cols.car;
      document.getElementById("expGasCol").innerText = t.exp_cols.gas;
      document.getElementById("expParkingCol").innerText = t.exp_cols.parking;
      document.getElementById("expFoodCol").innerText = t.exp_cols.food;
      document.getElementById("expMiscCol").innerText = t.exp_cols.misc;
      document.getElementById("expTotalCol").innerText = t.exp_cols.total;

      document.getElementById("expGrandLabel").innerText = t.exp_grand;
      document.getElementById("expSplitLabel").innerText = t.exp_per_person;
      document.getElementById("expNote").innerText = t.exp_note;

      const overrides = loadExpenseOverrides();
      const tbody = document.getElementById("expensesTableBody");
      tbody.innerHTML = "";

      tripData.days.forEach((d) => {
        const key = d.id;
        const base = d.expenses || {};
        const ov = overrides[key] || {};

        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="p-2 border whitespace-nowrap">${d.label}</td>
          ${["tickets","hotel","car","gas","parking","food","misc"].map(k => {
            const val = (ov[k] ?? base[k] ?? 0);
            return `<td class="p-2 border text-right">
              <input data-day="${key}" data-k="${k}" type="number" step="1" min="0"
                class="w-20 text-right text-sm rounded border px-2 py-1"
                value="${val}">
            </td>`;
          }).join("")}
          <td class="p-2 border text-right font-semibold" data-rowtotal="${key}">â€”</td>
        `;
        tbody.appendChild(row);
      });

      tbody.querySelectorAll("input").forEach(inp => {
        inp.addEventListener("input", () => {
          const dayId = inp.dataset.day;
          const k = inp.dataset.k;
          const v = Number(inp.value || 0);

          const all = loadExpenseOverrides();
          all[dayId] = all[dayId] || {};
          all[dayId][k] = v;
          saveExpenseOverrides(all);

          recomputeTotals(lang);
        });
      });

      recomputeTotals(lang);
    }

    function recomputeTotals(lang) {
      const currency = document.getElementById("currencySelect").value || "USD";
      const people = Math.max(1, Number(document.getElementById("splitPeople").value || 1));
      const overrides = loadExpenseOverrides();

      let grand = 0;

      tripData.days.forEach(d => {
        const base = d.expenses || {};
        const ov = overrides[d.id] || {};
        const total = ["tickets","hotel","car","gas","parking","food","misc"].reduce(
          (sum,k)=> sum + Number(ov[k] ?? base[k] ?? 0), 0
        );
        grand += total;

        const cell = document.querySelector(`[data-rowtotal="${d.id}"]`);
        if (cell) cell.innerText = `${currency} ${total.toFixed(0)}`;
      });

      document.getElementById("expGrandTotalCell").innerText = `${currency} ${grand.toFixed(0)}`;
      document.getElementById("expGrandValue").innerText = `${currency} ${grand.toFixed(0)}  Â·  ${people} pax`;
      document.getElementById("expSplitValue").innerText = `${currency} ${(grand/people).toFixed(0)}`;
    }

    // ===== Language switch =====
    function applyLang(lang) {
      const t = translations[lang] || translations.zh;
      document.title = t.page_title;

      document.getElementById("nav-title").innerText = t.nav_title;
      document.getElementById("nav-subtitle").innerText = t.nav_subtitle;

      document.getElementById("copyTodayLabel").innerText = t.copy_today;
      document.getElementById("exportIcsLabel").innerText = t.export_ics;

      document.getElementById("itineraryTitle").innerText = t.itinerary_title;
      document.getElementById("itineraryTip").innerText = t.itinerary_tip;

      document.getElementById("shareLabel").innerText = t.share_label;
      const shareUrl = document.getElementById("shareUrl");
      shareUrl.placeholder = t.share_placeholder;
      document.getElementById("shareHint").innerText = t.share_hint;

      document.getElementById("footerTitle").innerText = t.footer_title;
      document.getElementById("footerDesc").innerText = t.footer_desc;

      // Update <html lang="">
      const langMap = { zh: "zh-TW", en: "en", es: "es", ko: "ko", vi: "vi" };
      document.documentElement.lang = langMap[lang] || "zh-TW";

      // Update map language (best-effort): replace "!1sxx-XX!"
      const frame = document.getElementById("mapFrame");
      if (frame && frame.src) {
        const target = langMap[lang] || "zh-TW";
        frame.src = frame.src.replace(/!1s[^!]+!/, `!1s${target}!`);
      }

      // Re-render
      renderInfo(lang);
      renderDays(lang);

      // Reset expenses panel label to OPEN on lang change
      document.getElementById("toggleExpensesLabel").innerText = t.expenses_toggle_open;
      document.getElementById("expensesPanel").classList.add("hidden");
      renderExpenses(lang);

      document.getElementById("lastUpdatedBadge").innerText = formatLastUpdated(lang);
    }

    // ===== Share link =====
    async function shareLink() {
      const lang = document.getElementById("langSelect").value || "zh";
      const t = translations[lang] || translations.zh;
      const input = document.getElementById("shareUrl");
      const url = (input && input.value && input.value.trim()) ? input.value.trim() : window.location.href;
      try {
        await copyTextToClipboard(url);
        alert(t.share_msg);
      } catch(e) {
        alert("Copy failed");
      }
    }

    // ===== Wire up UI =====
    const langSelect = document.getElementById("langSelect");
    const copyTodayBtn = document.getElementById("copyTodayBtn");
    const exportIcsBtn = document.getElementById("exportIcsBtn");
    const shareBtn = document.getElementById("shareBtn");
    const copyShareBtn = document.getElementById("copyShareBtn");

    const toggleExpensesBtn = document.getElementById("toggleExpensesBtn");
    const expensesPanel = document.getElementById("expensesPanel");
    const splitPeople = document.getElementById("splitPeople");
    const currencySelect = document.getElementById("currencySelect");

    langSelect.addEventListener("change", () => applyLang(langSelect.value));

    copyTodayBtn.addEventListener("click", async () => {
      const lang = langSelect.value || "zh";
      const t = translations[lang] || translations.zh;
      const dayObj = getTodayOrFirstTripDay();
      try {
        await copyTextToClipboard(buildDayText(dayObj, lang));
        alert(t.share_msg);
      } catch(e) {
        alert("Copy failed");
      }
    });

    exportIcsBtn.addEventListener("click", () => {
      const lang = langSelect.value || "zh";
      // quick menu: export full trip; if you want today only, call exportIcs(lang, true)
      exportIcs(lang, false);
    });

    shareBtn.addEventListener("click", shareLink);
    copyShareBtn.addEventListener("click", shareLink);

    toggleExpensesBtn.addEventListener("click", () => {
      const lang = langSelect.value || "zh";
      const t = translations[lang] || translations.zh;
      const open = expensesPanel.classList.contains("hidden");
      expensesPanel.classList.toggle("hidden");
      document.getElementById("toggleExpensesLabel").innerText = open ? t.expenses_toggle_close : t.expenses_toggle_open;
    });

    splitPeople.addEventListener("input", () => recomputeTotals(langSelect.value || "zh"));
    currencySelect.addEventListener("change", () => recomputeTotals(langSelect.value || "zh"));

    // ===== Init =====
    applyLang(langSelect.value || "zh");
  </script>
</body>
</html>
